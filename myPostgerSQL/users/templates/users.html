{% extends "master.html" %}

{% block title %}
{{ title }}
{% endblock %}

{% block content %}
<p>{{ message }}</p>
{% if messages %}
    <ul class="messages" style="color=lightblue">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

    <div class="search" style="margin: 10px">
        <form class="search" action="{% url 'users' %}" method="get">
          <fieldset style="border: 1px solid lightblue">
            <legend style="color: lightblue" >Search</legend>
              <div class="select">
                <input type="radio" id="firstname" name="search_by" value="firstname"
                       data-label="by first name" {% if search_by == "firstname" %} checked {% endif %}>
                <label for="firstname">By firstname</label>

                <input type="radio" id="lastname" name="search_by" value="lastname"
                       data-label="by last name" {% if search_by == "lastname" %} checked {% endif %}>
                <label for="lastname">By lastname</label>

                <input type="radio" id="age" name="search_by" value="age"
                       data-label="by age" {% if search_by == "age" %} checked {% endif %}>
                <label for="age">By age</label>

                <input type="radio" id="email" name="search_by" value="email"
                       data-label="by email" {% if search_by == "email" %} checked {% endif %}>
                <label for="email">By email</label>

                <input type="radio" id="id" name="search_by" value="id"
                       data-label="by ID" {% if search_by == "id" %} checked {% endif %}>
                <label for="id">By ID</label>

                <input type="radio" id="phone" name="search_by" value="phone"
                       data-label="by phone" {% if search_by == "phone" %} checked {% endif %}>
                <label for="phone">By phone</label>

                <div>
                  <label for="gsearch" id="label_search">Search users by...</label>
                  <input type="search" id="gsearch" name="gsearch" placeholder="Enter request">
                  <input type="submit" value="Search">
                </div>
              </div>
          </fieldset>
        </form>
    </div>
    <div class="table_menu" style="margin: 10px;">
        <button type="button" onclick="openModal()">Add user</button>
        <div id="myModal" class="modal">
          <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
              <h4 style="color: lightblue;" id="userModalTitle"></h4>

                {% include 'userModal.html' %}


          </div>
        </div>
    </div>
    <table style="width:80%">
        <tr style="color: lightblue;font-size: 18px">
            <td>Num</td>
            <td>ID</td>
            <td>First name</td>
            <td>Last name</td>
            <td>Age</td>
            <td>Email</td>
            <td>Login</td>
            <td>Password</td>
            <td>Phone number</td>
        </tr>
        {% if users %}
          {% for user in users %}
        <tr class="{% cycle 'gray' 'pink' %}" id="row-{{ user.id }}">
          <!-- forloop.counter виводить номер рядка -->
          <td style="color: lightblue">{{ forloop.counter }}</td>
          <td>{{ user.id }}</td>

          <td>{{ user.firstname }}</td>
          <td>{{ user.lastname }}</td>
          <td>{{ user.age }}</td>
          <td><a href="#" onclick="event.preventDefault(); openModal('{{ user.id }}')">{{ user.email }}</a></td>
          <td>{{ user.login }}</td>
          <td>{{ user.password }}</td>
          <td>{{ user.phone }}</td>
          <td>
              <button type="button" class="delete" onclick="delUser('{{ user.id }}')">Delete</button>
          </td>
        </tr>
            {% empty %}
            <p>Немає даних</p>
            {% endfor %}

            {% else %}
            <p style="color: green;" >Немає ще даних</p>
            {% endif %}
    </table>
{% comment %}    <!-- Модальне вікно для редагування даних користувача -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h4 style="color: lightblue;" id="editUserTitle"></h4>
            {% include 'userModal.html' %}
        </div>
    </div>

{{ users|json_script:"users-data" }}
{% endcomment %}


<script src="/static/modal_user.js"></script>
<script>
    // Get the main search label element
    const mainSearchLabel = document.getElementById('label_search');

    // Get all radio buttons with the name "search_by"
    const searchByRadio = document.querySelectorAll('input[name="search_by"]');

    // A function to update the label's text
    function updateSearchLabel() {
        // Find the currently selected radio button
        const selectedRadio = document.querySelector('input[name="search_by"]:checked');

        // Get the text from the data-label attribute
        const labelText = selectedRadio ? selectedRadio.getAttribute('data-label') : 'by...';

        // Update the main label's text
        mainSearchLabel.textContent = `Search users ${labelText}`;
    }

    // Add an event listener to each radio button
    searchByRadio.forEach(radio => {
        radio.addEventListener('change', updateSearchLabel);
    });

    // Call the function once when the page loads to set the initial text
    document.addEventListener('DOMContentLoaded', updateSearchLabel);
</script>

{% endblock content %}